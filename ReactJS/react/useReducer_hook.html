<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- ReactJS @17-->
    <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
    <!-- React-DOM @17-->
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
    <!-- Babel -->
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <title>useReducer hook</title>
</head>
<!-- 

    khi nao dung useState, khi nao dung useReducer
    useState su dung trong truong hop component co state don gian
    
    useState:
        1. init state: 0
        2, action: up(state + 1), down(state - 1)

    useReducer:
        1. init state: 0
        2, action: up(state + 1), down(state - 1)
        3. Reducer
        4. Dispatch
 -->

<body>
    <div id="root"></div>
    <script type="text/babel">
        // // init state
        // const initState = 0
        // // action
        // const UP_ACTION = 'up'
        // const DOWN_ACTION = 'down'
        // // reducer
        // const reducer = (state, action) => {
        //     // trong lan dau tien thi reducer ko dc goi
        //     console.log('reducer running...');
        //     switch (action) {
        //         case UP_ACTION:
        //             return state + 1
        //         case DOWN_ACTION:
        //             return state - 1                         
        //         default:
        //             throw new Error('Invalid action')
        //     }
        // }
        // function App() {    
        //     const [count, dispatch] = React.useReducer(reducer, initState)
        //     console.log(count)

        //     return (
        //         <div style={{ padding: '0 20px' }}>
        //             <h1>{count}</h1>
        //             <button onClick={() => dispatch(UP_ACTION)}>Up</button>    
        //             <button onClick={() => dispatch(DOWN_ACTION)}>Down</button>    
        //         </div>
        //     )
        // }

        // init state
        const initState = {
            job: '',
            jobs: []
        }
        // action
        const SET_JOB = 'set_job'
        const ADD_JOB = 'add_job'
        const DELETE_JOB = 'delete_job'
        // reducer 
        const reducer = (state, action) => {

            console.log('Action: ', action);
            console.log('Prev state: ', state);

            let newState
            switch (action.type) {
                case SET_JOB:
                    newState = {
                        ...state,
                        job: action.payload
                    }
                    break
                case ADD_JOB:
                    newState = {
                        ...state,
                        jobs: [...state.jobs, action.payload]
                    }
                    break
                case DELETE_JOB:
                    const newJobs = [...state.jobs]
                    newJobs.splice(action.payload, 1)
                    newState = {
                        ...state,
                        jobs: newJobs
                    }
                    break

                default:
                    throw new Error('invalid action')
            }
            console.log('New state: ', newState);
            return newState
        }

        // dispatch

        function App() {
            const [state, dispatch] = React.useReducer(reducer, initState)
            const { job, jobs } = state

            const inputRef = React.useRef()

            const setJob = (payload) => {
                return {
                    type: SET_JOB,
                    payload
                }
            }

            const addJob = (payload) => {
                return {
                    type: ADD_JOB,
                    payload
                }
            }
            const deleteJob = (payload) => {
                return {
                    type: DELETE_JOB,
                    payload
                }
            }

            const handelSubmit = () => {
                dispatch(addJob(job))
                dispatch(setJob(''))
                inputRef.current.focus()
            }
            return (
                <div style={{ padding: '20px 20px' }}>
                    <h1>Todo</h1>
                    <input
                        value={job}
                        placeholder="Enter todo..."
                        onChange={e => {
                            dispatch(setJob(e.target.value))
                        }}
                        ref={inputRef}
                    />
                    <button onClick={handelSubmit}>Add</button>
                    <ul>
                        {jobs.map((job, index) => (
                            <li key={index}>{job}
                                <span
                                    onClick={() => dispatch(deleteJob(index))}
                                    style={{ cursor: "pointer"}}
                                    >
                                    &times;
                                </span>
                                
                            </li>
                        ))}
                    </ul>
                </div>
            )
        }

        ReactDOM.render(<App />, document.querySelector('#root'))
    </script>
</body>

</html>